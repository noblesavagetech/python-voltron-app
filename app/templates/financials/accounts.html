{% extends "base.html" %}

{% block title %}Accounts - BBA Services{% endblock %}

{% block content %}
<style>
.financial-dashboard { max-width: 1400px; margin: 0 auto; }
.dashboard-nav { background: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px; }
.dashboard-nav-links { display: flex; gap: 15px; flex-wrap: wrap; }
.dashboard-nav-links a { padding: 10px 20px; background: #f3f4f6; border-radius: 6px; text-decoration: none; color: #374151; transition: all 0.3s; }
.dashboard-nav-links a:hover, .dashboard-nav-links a.active { background: #667eea; color: white; }
.accounts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 30px; }
.account-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
.account-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
.account-institution { font-weight: 700; font-size: 18px; color: #1f2937; }
.account-type { background: #667eea; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; }
.account-name { color: #6b7280; margin-bottom: 5px; }
.account-mask { color: #9ca3af; font-size: 14px; }
.account-balance { margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
.balance-label { color: #6b7280; font-size: 14px; }
.balance-amount { font-size: 28px; font-weight: 700; color: #10b981; margin-top: 5px; }
.stats-summary { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px; }
.stats-summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
.summary-stat { text-align: center; padding: 15px; }
.summary-label { color: #6b7280; font-size: 14px; display: block; margin-bottom: 8px; }
.summary-value { font-size: 24px; font-weight: 700; color: #1f2937; }
.loading-spinner { text-align: center; padding: 40px; }
.loading-spinner i { font-size: 32px; color: #667eea; animation: spin 1s linear infinite; }
.loading-spinner p { margin-top: 15px; color: #6b7280; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
</style>

<div class="financial-dashboard">
    <div class="dashboard-header">
        <h1>ðŸ’³ Accounts Dashboard</h1>
        <p style="color: #666;">Manage all your financial accounts</p>
    </div>

    <div class="dashboard-nav">
        <div class="dashboard-nav-links">
            <a href="{{ url_for('financials.overview') }}">Overview</a>
            <a href="{{ url_for('financials.accounts') }}" class="active">Accounts</a>
            <a href="{{ url_for('financials.transactions') }}">Transactions</a>
            <a href="{{ url_for('financials.investments') }}">Investments</a>
            <a href="{{ url_for('financials.analytics') }}">Analytics</a>
        </div>
    </div>

    <div id="loadingState" class="loading-spinner">
        <i class="fas fa-circle-notch fa-spin"></i>
        <p>Loading accounts...</p>
    </div>

    <div id="mainContent" style="display: none;">
        <div class="stats-summary">
            <div class="stats-summary-grid">
                <div class="summary-stat">
                    <span class="summary-label">Total Assets</span>
                    <div class="summary-value" id="totalAssets">$0</div>
                </div>
                <div class="summary-stat">
                    <span class="summary-label">Total Liabilities</span>
                    <div class="summary-value" id="totalLiabilities">$0</div>
                </div>
                <div class="summary-stat">
                    <span class="summary-label">Net Worth</span>
                    <div class="summary-value" id="netWorth">$0</div>
                </div>
                <div class="summary-stat">
                    <span class="summary-label">Total Accounts</span>
                    <div class="summary-value" id="totalAccounts">0</div>
                </div>
            </div>
        </div>

        <div class="accounts-grid" id="accountsGrid">
            <!-- Populated by JavaScript -->
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<script>
class AccountsDashboard {
    async init() {
        await this.loadAccounts();
    }

    async loadAccounts() {
        try {
            const response = await fetch('/api/financials/accounts');
            const data = await response.json();
            
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            this.renderSummary(data.totals);
            this.renderAccounts(data.accounts);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    renderSummary(totals) {
        document.getElementById('totalAssets').textContent = this.formatCurrency(totals.total_assets);
        document.getElementById('totalLiabilities').textContent = this.formatCurrency(totals.total_liabilities);
        document.getElementById('netWorth').textContent = this.formatCurrency(totals.net_worth);
    }

    renderAccounts(accounts) {
        const grid = document.getElementById('accountsGrid');
        document.getElementById('totalAccounts').textContent = accounts.length;

        if (accounts.length === 0) {
            grid.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">No accounts linked. <a href="/plaid/link">Link an account</a> to get started.</p>';
            return;
        }

        grid.innerHTML = accounts.map(acc => `
            <div class="account-card">
                <div class="account-header">
                    <div class="account-institution">${acc.institution}</div>
                    <div class="account-type">${acc.subtype || acc.type}</div>
                </div>
                <div class="account-name">${acc.name}</div>
                <div class="account-mask">â€¢â€¢â€¢â€¢ ${acc.mask}</div>
                <div class="account-balance">
                    <div class="balance-label">Current Balance</div>
                    <div class="balance-amount">${this.formatCurrency(acc.balance)}</div>
                </div>
            </div>
        `).join('');
    }

    formatCurrency(amount) {
        return '$' + Math.abs(amount).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new AccountsDashboard().init();
});
</script>
{% endblock %}
